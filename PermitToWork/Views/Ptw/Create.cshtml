@using PermitToWork.Models.Ptw
@model PtwEntity
@{
    string position = ViewBag.position as String;
    int isPosition = position == "Create" ? 1 : 0;
    var requestor = Session["user"] as PermitToWork.Models.User.UserEntity;
    var listUser = ViewBag.listUser as PermitToWork.Models.User.ListUser;
    List<bool?> user_ptw = new List<bool?>();
    user_ptw.Add(ViewBag.isRequestor as bool?);
    user_ptw.Add(ViewBag.isAccSupervisor as bool?);
    user_ptw.Add(ViewBag.isAccAssessor as bool?);
    user_ptw.Add(ViewBag.isAccFO as bool?);
    user_ptw.Add(ViewBag.isCanSupervisor as bool?);
    user_ptw.Add(ViewBag.isCanAssessor as bool?);
    user_ptw.Add(ViewBag.isCanFO as bool?);
    bool? isClearenceComplete = ViewBag.isClearenceComplete as bool?;
    bool? isClearenceClose = ViewBag.isClearenceClose as bool?;
    bool? isCancel = ViewBag.isCancel as bool?;
    bool? isCanEdit = ViewBag.isCanEdit as bool?;
    if (isCanEdit == null) {
        isCanEdit = true;
    }
}

<script>
    $(document).ready(function () {
        addHandlerMenu();

        $('#InputExtensionPtw').css('display', 'none');
        $('#area').css('display', 'none');

        if($('#extendPtw1').is(':checked')){
            $('#InputExtensionPtw').css('display','block');
        }else{
            $('#InputExtensionPtw').css('display','none');
        }

        $('input[name = "area"]').change(function () {
            if (($(this).val() == 0)) {
                $('#area').css('display', 'block');
            } else {
                $('#area').css('display', 'none');
            }
        });

        function startChange() {
            var startDate = start.value();

            if (startDate) {
                startDate = new Date(startDate);
                startDate.setDate(startDate.getDate());
                end.min(startDate);
                end.max(addDays(startDate, 7));
            }
        }

        function endChange() {
            var endDate = end.value();

            if (endDate) {
                endDate = new Date(endDate);
                endDate.setDate(endDate.getDate());
                //start.max(endDate);
            }
        }

        var start = $("#proposed_period_start").kendoDateTimePicker({
            change: startChange,
            parseFormats: ["MM/dd/yyyy"]
        }).data("kendoDateTimePicker");

        var end = $("#proposed_period_end").kendoDateTimePicker({
            change: endChange,
            parseFormats: ["MM/dd/yyyy"]
        }).data("kendoDateTimePicker");

        start.max(end.value());
        end.min(start.value());


        $("#files").kendoUpload({
            multiple: true,
            async: {
                saveUrl: "Hira/Save",
                removeUrl: "Hira/Remove",
                autoUpload: true
            },
            upload: onUpload,
            success: onSuccess,
        });

        var $fileList, $files, item, _fn, _i, _len;

        $fileList = $("#existing-files");

        if ($fileList.length > 0) {
            $(".k-upload").append($fileList);
            $files = $(".k-file");
            _fn = function (item) {
                var $item, fileId, filenames;
                $item = $(item);
                fileId = $item.data("att-id");
                filenames = [
                  {
                      name: fileId
                  }
                ];
                return $item.data("fileNames", filenames);
            };
            for (_i = 0, _len = $files.length; _i < _len; _i++) {
                item = $files[_i];
                _fn(item);
            }
            $fileList.show();
        }

        function startChangeValidity() {
            var startDate = startValidity.value();

            if (startDate) {
                startDate = new Date(startDate);
                startDate.setDate(startDate.getDate());
                endValidity.min(startDate);
                endValidity.max(addDays(startDate, 7));
            }
        }

        function endChangeValidity() {
            var endDate = endValidity.value();

            if (endDate) {
                endDate = new Date(endDate);
                endDate.setDate(endDate.getDate());
                //startValidity.max(endDate);
            }
        }

        var startValidity = $("#validity_period_start").kendoDatePicker({
            change: startChangeValidity,
            parseFormats: ["MM/dd/yyyy"]
        }).data("kendoDatePicker");

        var endValidity = $("#validity_period_end").kendoDatePicker({
            change: endChangeValidity,
            parseFormats: ["MM/dd/yyyy"]
        }).data("kendoDatePicker");

        function addDays(myDate, days) {
            return new Date(myDate.getTime() + days * 24 * 60 * 60 * 1000);
        }


        if (endValidity != undefined || startValidity != undefined) {
            endValidity.min(startValidity.value());
            endValidity.max(addDays(new Date(startValidity.value()),7));
        }

        $("#cancellation_date").kendoDatePicker().data("kendoDatePicker");

        //checkbox
        $('#loto').change(function () {
            //changeContent('loto/create');
        })
        $('#csep').change(function () {
            //changeContent('csep/create');
        })
        $('#hw_id').click(function () {
            changeContent('hw/edit/' + $(this).attr('data-id'));
        })
        $('#fi').change(function () {
            //changeContent('fi/create');
        })
        $('#ex').change(function () {
            //changeContent('ex/create');
        })
        $('#wh').change(function () {
            //changeContent('workingHeight/create');
        })
        $('#rg').change(function () {
            //changeContent('radiography/create');
        })

        $('#requestor_acc').click(function () {
            var values = {
                id : '@Model.id',
                user_id : '@requestor.id',
            };
            $('#requestor_acc').attr('disabled', 'disabled');
            $('#loading_requestor_acc').show();
            $.post("Ptw/requestorAcc", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#requestor_acc').removeAttr('disabled');
                    $('#loading_requestor_acc').hide();
                    alert("Failed to approve Permit To Work.");
                } else if (resp.status == "404") {
                    $('#requestor_acc').removeAttr('disabled');
                    $('#loading_requestor_acc').hide();
                    alert("Failed to approve Permit to Work. Are you trying something not your access?");
                }
            });
        });

        $('#supervisor_acc').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id',
                assessor_id: $('#acc_assessor').val(),
            };
            $('#supervisor_acc').attr('disabled', 'disabled');
            $('#loading_supervisor_acc').show();
            $.post("Ptw/supervisorAcc", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#supervisor_acc').removeAttr('disabled');
                    $('#loading_supervisor_acc').hide();
                    alert("Failed to approve Permit To Work.");
                } else if (resp.status == "404") {
                    $('#supervisor_acc').removeAttr('disabled');
                    $('#loading_supervisor_acc').hide();
                    alert("Failed to approve Permit to Work. Are you trying something not your access?");
                } else if (resp.status == "401") {
                    $('#supervisor_acc').removeAttr('disabled');
                    $('#loading_supervisor_acc').hide();
                    alert("Failed to approve Permit to Work. You must choose Assessor.");
                }
            });
        });

        $('#supervisor_reject').click(function () {
            $('#type_reject').val(1);
            $('#rejection').modal('show');
        });

        $('#assessor_reject').click(function () {
            $('#type_reject').val(2);
            $('#rejection').modal('show');
        });

        $('#fo_reject').click(function () {
            $('#type_reject').val(3);
            $('#rejection').modal('show');
        });

        $('#supervisor_reject_can').click(function () {
            $('#type_reject').val(4);
            $('#rejection').modal('show');
        });

        $('#assessor_reject_can').click(function () {
            $('#type_reject').val(5);
            $('#rejection').modal('show');
        });

        $('#fo_reject_can').click(function () {
            $('#type_reject').val(6);
            $('#rejection').modal('show');
        });

        $('#reject_button').click(function () {
            var type = $('#type_reject').val();
            var url = '';
            var comment = $('#comment').val();
            switch (type) {
                case '1': url = 'Ptw/supervisorAccReject'; break;
                case '2': url = 'Ptw/assessorAccReject'; break;
                case '3': url = 'Ptw/fOAccReject'; break;
                case '4': url = 'Ptw/supervisorCanReject'; break;
                case '5': url = 'Ptw/assessorCanReject'; break;
                case '6': url = 'Ptw/fOCanReject'; break;
            };
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id',
                comment: comment,
            };
            $('#reject_button').attr('disabled', 'disabled');
            $('#loading_reject').show();
            $.post(url, values, function (resp) {
                if (resp.status == "200") {
                    $('#rejection').modal('hide');
                    save();
                } else if (resp.status == "400") {
                    $('#rejection').modal('hide');
                    $('#reject_button').removeAttr('disabled');
                    $('#loading_reject').hide();
                    alert("Failed to reject Permit To Work.");
                } else if (resp.status == "404") {
                    $('#rejection').modal('hide');
                    $('#reject_button').removeAttr('disabled');
                    $('#loading_reject').hide();
                    alert("Failed to reject Permit to Work. Are you trying something not your access?");
                }
            });
        });

        $('#assessor_acc').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id',
                fo_id: $('#acc_fo').val(),
            };
            $('#assessor_acc').attr('disabled', 'disabled');
            $('#loading_assessor_acc').show();
            $.post("Ptw/assessorAcc", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#assessor_acc').removeAttr('disabled');
                    $('#loading_assessor_acc').hide();
                    alert("Failed to approve Permit To Work.");
                } else if (resp.status == "404") {
                    $('#assessor_acc').removeAttr('disabled');
                    $('#loading_assessor_acc').hide();
                    alert("Failed to approve Permit to Work. Are you trying something not your access?");
                } else if (resp.status == "401") {
                    $('#assessor_acc').removeAttr('disabled');
                    $('#loading_assessor_acc').hide();
                    alert("Failed to approve Permit to Work. You must choose Facility Owner.");
                    $('#acc_fo').attr('required', 'required');
                }
            });
        });

        $('#fo_acc').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id'
            };
            $('#fo_acc').attr('disabled', 'disabled');
            $('#loading_fo_acc').show();
            $.post("Ptw/fOAcc", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#fo_acc').removeAttr('disabled');
                    $('#loading_fo_acc').hide();
                    alert("Failed to approve Permit To Work.");
                } else if (resp.status == "404") {
                    $('#fo_acc').removeAttr('disabled');
                    $('#loading_fo_acc').hide();
                    alert("Failed to approve Permit to Work. Are you trying something not your access?");
                }
            });
        });

        $('#requestor_can').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id',
            };
            $('#requestor_can').attr('disabled', 'disabled');
            $('#loading_requestor_can').show();
            $.post("Ptw/requestorCan", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#requestor_can').removeAttr('disabled');
                    $('#loading_requestor_can').hide();
                    alert("Failed to approve Cancellation Permit To Work.");
                } else if (resp.status == "404") {
                    $('#requestor_can').removeAttr('disabled');
                    $('#loading_requestor_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. Are you trying something not your access?");
                }
            });
        });

        $('#supervisor_can').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id'
            };
            $('#supervisor_can').attr('disabled', 'disabled');
            $('#loading_supervisor_can').show();
            $.post("Ptw/supervisorCan", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#supervisor_can').removeAttr('disabled');
                    $('#loading_supervisor_can').hide();
                    alert("Failed to approve Cancellation Permit To Work.");
                } else if (resp.status == "404") {
                    $('#supervisor_can').removeAttr('disabled');
                    $('#loading_supervisor_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. Are you trying something not your access?");
                } else if (resp.status == "401") {
                    $('#supervisor_can').removeAttr('disabled');
                    $('#loading_supervisor_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. You must choose Assessor.");
                }
            });
        });

        $('#assessor_can').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id'
            };
            $('#assessor_can').attr('disabled', 'disabled');
            $('#loading_assessor_can').show();
            $.post("Ptw/assessorCan", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#assessor_can').removeAttr('disabled');
                    $('#loading_assessor_can').hide();
                    alert("Failed to approve Cancellation Permit To Work.");
                } else if (resp.status == "404") {
                    $('#assessor_can').removeAttr('disabled');
                    $('#loading_assessor_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. Are you trying something not your access?");
                } else if (resp.status == "401") {
                    $('#assessor_can').removeAttr('disabled');
                    $('#loading_assessor_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. You must choose Facility Owner.");
                    $('#acc_fo').attr('required', 'required');
                }
            });
        });

        $('#fo_can').click(function () {
            var values = {
                id: '@Model.id',
                user_id: '@requestor.id'
            };

            $('#fo_can').attr('disabled', 'disabled');
            $('#loading_fo_can').show();
            $.post("Ptw/fOCan", values, function (resp) {
                if (resp.status == "200" || resp.status == "201") {
                    save();
                } else if (resp.status == "400") {
                    $('#fo_can').removeAttr('disabled');
                    $('#loading_fo_can').hide();
                    alert("Failed to approve Cancellation Permit To Work.");
                } else if (resp.status == "404") {
                    $('#fo_can').removeAttr('disabled');
                    $('#loading_fo_can').hide();
                    alert("Failed to approve Cancellation Permit to Work. Are you trying something not your access?");
                }
            });
        });

        $('input[name = "area"]:checked').trigger('change');
    })

    function onUpload(e) {
        // Array with information about the uploaded files
        var files = e.files;
        
        // Check the extension of each file and abort the upload if it is not .jpg
        $.each(files, function () {
            if (this.extension != ".pdf") {
                alert("Only .pdf files can be uploaded.")
                e.preventDefault();
            }
        });
        e.data = { id_ptw: '@Model.id' };
    }

    function onSuccess(e) {
        var files = e.files;
        
        // Check the extension of each file and abort the upload if it is not .jpg
        $.each(files, function () {
            $('.k-filename[title="' + this.name + '"]').html('<a href="/Upload/Hira/' + this.name + '">' + this.name + '</a>');
        });
    }

    function save() {
        var area = "";
        var checkBoxes = $("input[name='area']");
        $.each(checkBoxes, function () {
            if ($(this).attr('checked')) {
                area = $(this).val();
            }
        });
        if (area == "0") {
            area = $('#area').val();
        }

        var values = {
            proposed_period_start: $('#proposed_period_start').val(),
            proposed_period_end: $('#proposed_period_end').val(),
            dept_requestor: $('#dept_requestor').val(),
            section: $('#section').val(),
            requestor_ptw_holder_no: $('#requestor_ptw_holder_no').val(),
            area: area,
            total_crew: $('#total_crew').val(),
            work_location: $('#work_location').val(),
            work_order_no: $('#work_order_no').val(),
            work_description: $('#work_description').val(),
            area_code: $('#area_code').val(),
            acc_ptw_requestor: '@requestor.id',
            can_ptw_requestor: '@requestor.id',
            pre_job_1_spv: $('#pre_job_1_spv').val(),
            pre_job_2_spv: $('#pre_job_2_spv').val(),
            pre_job_3_spv: $('#pre_job_3_spv').val(),
            pre_job_4_spv: $('#pre_job_4_spv').val(),
            pre_job_5_spv: $('#pre_job_5_spv').val(),
            pre_job_6_spv: $('#pre_job_6_spv').val(),
            pre_job_7_spv: $('#pre_job_7_spv').val(),
            pre_job_1_fo: $('#pre_job_1_fo').val(),
            pre_job_2_fo: $('#pre_job_2_fo').val(),
            pre_job_3_fo: $('#pre_job_3_fo').val(),
            pre_job_4_fo: $('#pre_job_4_fo').val(),
            pre_job_5_fo: $('#pre_job_5_fo').val(),
            pre_job_6_fo: $('#pre_job_6_fo').val(),
            pre_job_7_fo: $('#pre_job_7_fo').val(),
            cancel_1_spv: $('#cancel_1_spv').val(),
            cancel_2_spv: $('#cancel_2_spv').val(),
            cancel_3_spv: $('#cancel_3_spv').val(),
            cancel_4_spv: $('#cancel_4_spv').val(),
            cancel_5_spv: $('#cancel_5_spv').val(),
            cancel_6_spv: $('#cancel_6_spv').val(),
            cancel_7_spv: $('#cancel_7_spv').val(),
            cancel_1_fo: $('#cancel_1_fo').val(),
            cancel_2_fo: $('#cancel_2_fo').val(),
            cancel_3_fo: $('#cancel_3_fo').val(),
            cancel_4_fo: $('#cancel_4_fo').val(),
            cancel_5_fo: $('#cancel_5_fo').val(),
            cancel_6_fo: $('#cancel_6_fo').val(),
            cancel_7_fo: $('#cancel_7_fo').val(),
            pre_job_notes : $('#pre_job_notes').val(),
            cancel_notes : $('#cancel_notes').val(),
            validity_period_start : $('#validity_period_start').val(),
            validity_period_end : $('#validity_period_end').val(),
            cancellation_date: $('#cancellation_date').val(),
            acc_assessor: $('#acc_assessor').val(),
            acc_fo: $('#acc_fo').val(),
            hw_need: $('#hw').is(':checked') ? 1 : 0,
        };

        if ('@isPosition' == 1) {
            var hira = [];
            $('.k-filename').each(function () {
                hira.push($(this).attr('title'));
            });
            values.hiras = hira;
            $('#save').attr('disabled', 'disabled');
            $('#loading').css('display','inline-block');
            $.post("/Ptw/Add", $.param(values, true), function (resp) {
                if (resp.status == "200") {
                    alert("Permit to Work save successful!");
                    $('#content').load('Ptw/Edit/' + resp.id);
                } else if (resp.status == "400") {
                    $('#save').removeAttr('disabled');
                    $('#loading').hide();
                    alert("Permit to Work failed to save\nMessage : " + resp.message);
                }
            });
        } else {
            values.id = '@Model.id';
            $.post("/Ptw/EditPtw", values, function (resp) {
                if (resp.status == "200") {
                    alert("Permit to Work save successful!");
                    $('#content').load('Ptw/Edit/@Model.id');
                } else if (resp.status == "400")
                    alert("Permit to Work failed to save\nMessage : " + resp.message);
            });
        }
    }

    function back() {
        $('#content').load('Ptw/Index');
    }

    function cancelPtw() {
        var r = confirm("Are you sure want to Cancel this Permit to Work?");
        var values = {
            id: '@Model.id',
            user_id: '@requestor.id',
        };
        if (r == true) {
            $.post("/Ptw/CancelPtw", values, function (resp) {
                if (resp.status == "200") {
                    alert("Permit to Work has cancelled by Requestor.");
                    $('#content').load('Ptw/Edit/@Model.id');
                }
            });
        } else {

        }
    }
</script>

<div id="content-header">
	<h1>Permit To Work</h1>
</div>
<div id="breadcrumb">
	<a href="#" title="Go to Home" class="tip-bottom home"><i class="icon-home"></i> Home</a>
	<a href="#"  class="tip-bottom ptw">Permit To Work </a>
    <a href="#" class="current">Create</a>
</div>

<div class="container-fluid header-form">
    <div class="row-fluid">
        <div class="span3 logo">
            <img src="../../Img/logo-clean.png" />
        </div>
        <div class="span6 title">
            <b>PERMIT TO WORK</b><br />
            Star Energy Geothermal (Wayang Windu) Limited
        </div>

        <div class="span3 no">
            No <button class="btn">SAFETY BRIEFING</button>
            <br /><i>PTW No : @Model.ptw_no</i>
        </div>
    </div>
    <div class="row-fluid separator">
    </div>
</div>

<div class="container-fluid">
    <div class="row-fluid">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="title-form" colspan="4"><b>1.  GENERAL INFORMATION </b><span><i>(Filled by requestor prior to submit PTW request to Facility Owner)</i></span></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Propose Period <small><i>(max 1 week)</i></small></td>
                    <td>From : <input id="proposed_period_start" class="datetimepicker" value="@(Model.proposed_period_start != null ? Model.proposed_period_start.Value.ToString("MM/dd/yyyy hh:mm tt") : DateTime.Today.ToString("MM/dd/yyyy hh:mm tt"))" @(isCanEdit == true ? "" : "disabled") /></td>
                    <td>Until : <input id="proposed_period_end" class="datetimepicker" value="@(Model.proposed_period_end != null ? Model.proposed_period_end.Value.ToString("MM/dd/yyyy hh:mm tt") : DateTime.Today.AddDays(7).ToString("MM/dd/yyyy hh:mm tt"))" @(isCanEdit == true ? "" : "disabled") /></td>
                    <td>
                        <ul class="inline table-ul">
                            <li>Extension PTW? </li>
                            <li><label class="radio"><input name="extensionPtw" type="radio" value="1" id="extendPtw1" @(Model.is_extend == 1 ? "checked" : "") disabled/> yes</label>
                            </li>
                            <li><label class="radio"><input name="extensionPtw" type="radio" value="0" id="extendPtw0" @(Model.is_extend != 1 ? "checked" : "") disabled/> no</label>
                            </li>
                        </ul>
                        <div id="InputExtensionPtw">
                            <input  class="table-input table-input-170" type="text" disabled value="@Model.extend_ptw_no">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Dept. of Requestor : <br /><input class="table-input table-input-170" id="dept_requestor" type="text" value="@(Model.dept_requestor != null ? Model.dept_requestor : "")" @(isCanEdit == true ? "" : "disabled") /></td>
                    <td colspan="2">Section / Total number crew : <input class="table-input table-input-120" id="section" type="text" value="@(Model.section != null ? Model.section : "")" @(isCanEdit == true ? "" : "disabled") /> / <input class="table-input table-input-120" id="total_crew" type="text" value="@(Model.total_crew != null ? Model.total_crew : "")" @(isCanEdit == true ? "" : "disabled") /></td>
                    <td>Requestor's PTW holder no. :<br /> <input class="table-input table-input-170" id="requestor_ptw_holder_no" type="text" value="@(Model.requestor_ptw_holder_no != null ? Model.requestor_ptw_holder_no : "")" @(isCanEdit == true ? "" : "disabled") /></td>
                </tr>
                <tr>
                    <td colspan="4">
                        <ul class="inline table-ul">
                            <li>AREA : </li>
                            <li><label class="radio"><input name="area" type="radio" value="1" @(Model.area == "1" ? "checked" : "")  @(isCanEdit == true ? "" : "disabled") />Power Station</label></li>
                            <li> <label class="radio"><input name="area" type="radio" value="2" @(Model.area == "2" ? "checked" : "") @(isCanEdit == true ? "" : "disabled") />Steam Field</label></li>
                            <li> <label class="radio"><input name="area" value="0" type="radio" @(Model.area != "1" && Model.area != "2" && Model.area != null ? "checked" : "") @(isCanEdit == true ? "" : "disabled") />Others</label></li>
                            <li><input class="table-input table-input-170" id="area" type="text"  @(Model.area != "1" && Model.area != "2" ? "" : "disabled") value="@(Model.area != "1" && Model.area != "2" && Model.area != null ? Model.area : "")" @(isCanEdit == true ? "" : "disabled") /></li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">Work Location : <input class="table-input table-input-170" id="work_location" type="text" value="@(Model.work_location != null ? Model.work_location : "")" @(isCanEdit == true ? "" : "disabled") /> , Area Code : <input class="table-input table-input-120" id="area_code" type="text" value="@(Model.area_code != null ? Model.area_code : "")" @(isCanEdit == true ? "" : "disabled") /></td>
                    <td>Work Order No: <input class="table-input table-input-170" id="work_order_no" type="text" value="@(Model.work_order_no != null ? Model.work_order_no : "")" @(isCanEdit == true ? "" : "disabled") /></td>
                </tr>
                <tr>
                    <td colspan="4">Work Description : <br/>
                        <textarea class="table-textarea" id="work_description" @(isCanEdit == true ? "" : "disabled")>@(Model.work_description != null ? Model.work_description : "")</textarea>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <td colspan="4"><strong>Specify Clearance Permit Require</strong> <em><small>(All clearance and Hira must be completed prior to PTW approval)</small></em>
                    </td>
                </tr>
                <tr>
                    <td class="td-centre"><strong>Check</strong></td>
                    <td class="td-centre"><strong>Clearance Permit Require</strong></td>
                    <td class="td-centre" style="width:20%"><strong>Clearance Permit Number</strong></td>
                    <td class="td-centre"><strong>Clearance Permit Status</strong></td>
                    <td class="td-centre" style="width:25%"><strong>Minimum Document Required</strong></td>
                    <td class="td-centre" style="width:25%"><strong>Form to be Completed and Enclosed</strong></td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="loto" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">Lock Out Tag Out (LOTO)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Requestor's supervisor LOTO point proposal</td>
                    <td class="small">Lock Appllication Form (102a): description, drawing references, supervisor LOTO point proposal LOTO permit form (102b): general info</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="csep" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">Confined Space Entry Permit (CSEP)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Confined space emergency evacuation plan</td>
                    <td class="small">CSEP form(103a) : general info, spv initial hazard screening  emergency evacuation form(101c) Approved emergency evacuation plan</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="hw" type="checkbox" @(isCanEdit == true ? "" : "disabled") @(Model.hw_id != null ? "checked" : "") /></td>
                    <td class="small">Hot Work (HW)</td>
                    <td class="small">
                        @if (Model.hw_id != null)
                        {
                            <button class="btn btn-small" id="hw_id" data-id="@Model.hw_id">@Model.hw_no&nbsp;</button>
                        }
                    </td>
                    <td class="small">
                        @Html.Raw(Model.hwStatus())
                    </td>
                    <td class="small">Emergency evacuation plan, competence fire attendance</td>
                    <td class="small">HW form(104a) : general info, initial hazard screening  emergency evacuation form(101c) Approved emergency evacuation plan</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="fi" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">Fire Impairment (FI)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Fire operation system back up plan</td>
                    <td class="small">FI form(105a) : general info, clearance from spv, ERT leader, safety officer</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="ex" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">Excavation (Ex)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Excavation clearance from facility + E&I officer</td>
                    <td class="small">Ex form(106a) : general info, clearance from facility + E&I officer</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="wh" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">Working at Height (WH)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Working at height emergency evacuation plan, scafolder certificate (for scafolding erection)</td>
                    <td class="small">WH form(107a) : general info, supervisor assesment</td>
                </tr>
                <tr>
                    <td class="td-centre"><input id="rg" type="checkbox" @(isCanEdit == true ? "" : "disabled")/></td>
                    <td class="small">RadioGraphic (Rad)</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">&nbsp;</td>
                    <td class="small">Copy of certificate of competences: radiographic (engineer, operator, safety), emergency rescue plan, radioactive equipment & material manifest</td>
                    <td class="small">Rad form (108a) : general info, initial assesment (spv, engineer, operator, safety officer)</td>
                </tr>
                <tr>
                    <td colspan="4">
                        HIRA no : <em><small>(choose HIRA number and copy of HIRA must be attach)</small></em>                          
                        <input name="files" id="files" type="file" @(isCanEdit == true ? "" : "disabled") />
                        @{
                            if(Model.hira_document != null && Model.hira_document.Count > 0){
                                <ul id="existing-files" class="k-upload-files k-reset" style="display: none;">
                                    @foreach (PermitToWork.Models.Hira.HiraEntity hira in Model.hira_document) {
                                    <li class="k-file" data-att-id="@(hira.filename)">
                                        <span class="k-icon k-success">uploaded</span>
                                        <span class="k-filename" title="@(hira.filename)"><a href="@hira.location">@hira.filename</a><span class="k-progress"><span class="k-state-selected k-progress-status" style="width: 100%;"></span></span></span>
                                        <button type="button" class="k-button k-button-icontext k-upload-action"><span class="k-icon k-delete"></span>Remove</button>
                                    </li>
                                    }
                                </ul>
                            }
                        }   
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="row-fluid separator-dash">
        </div>
        <br />
@if(isPosition != 1) {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="title-form" colspan="4"><strong>2.  PRE-JOB SCREENING </strong><span></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="2"><strong>No</strong></td>
                    <td rowspan="2"><strong>Description<br/> </strong><em><small>(Answer the screening items with Yes, No or N/A)</small></em></td>
                    <td colspan="2" class="td-centre"><strong>Assesments (Y, No, N/A)</strong></td>
                </tr>
                <tr>
                    <td><strong>Requestor's Supervisor</strong></td>
                    <td><strong>Facility Owner</strong></td>
                </tr>
                <tr>
                    <td>1</td>
                    <td class="small">Are the <strong>clearance permit</strong> (see refer to above clearance requirement checked) completed and attach to the permit?</td>
                    <td>
                        <select id="pre_job_1_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_1_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_1_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_1_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_1_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_1_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_1_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_1_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td class="small">Are person to do this job qualified?</td>
                    <td>
                        <select id="pre_job_2_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_2_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_2_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_2_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_2_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_2_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_2_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_2_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td class="small">Are the works changing the system or design available this time?</td>
                    <td>
                        <select id="pre_job_3_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_3_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_3_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_3_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_3_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_3_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_3_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_3_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td class="small">Is there a valid written procedure (SOP) for the work?</td>
                    <td>
                        <select id="pre_job_4_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_4_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_4_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_4_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_4_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_4_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_4_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_4_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>5</td>
                    <td class="small">Are tools suitable and in good condition?</td>
                    <td>
                        <select id="pre_job_5_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_5_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_5_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_5_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_5_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_5_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_5_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_5_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>6</td>
                    <td class="small">Is the safety equipments required available and reliable to use?</td>
                    <td>
                        <select id="pre_job_6_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_6_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_6_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_6_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_6_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_6_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_6_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_6_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>7</td>
                    <td class="small">Have all identified hazards been controlled</td>
                    <td>
                        <select id="pre_job_7_spv" @(user_ptw[1] == true && Model.acc_supervisor_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_7_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_7_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_7_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="pre_job_7_fo" @(user_ptw[3] == true && Model.acc_fo_approve == null && isCanEdit == true ? "" : "disabled")>
                          <option value="0" @(Model.pre_job_7_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.pre_job_7_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.pre_job_7_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="4" class="small">
                        Note: <em>write any concern related to these assesment and attach other check sheet if necessary; Spv: requestor's 
                                supervisor project maanger; FO : Facility owner; All parties have right to stop work when control method is not adequate to control the hazard
                              </em><br />
                        <textarea class="table-textarea" id="pre_job_notes" @(isCanEdit == true ? "" : "disabled")>@Model.pre_job_notes</textarea>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="title-form" colspan="2"><strong>3. ACCEPTANCE & VALIDATION</strong></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        Validity period, from :  <input id="validity_period_start" class="datetimepicker" value="@(user_ptw[3] == true && Model.acc_fo_approve == null ? Model.proposed_period_start.Value.ToString("MM/dd/yyyy hh:mm tt") : (Model.validity_period_start != null ? Model.validity_period_start.Value.ToString("MM/dd/yyyy hh:mm tt") : ""))" @(user_ptw[3] == true && Model.acc_fo_approve == null ? "" : "disabled") >
                    </td>
                    <td>
                        Validity period, to :  <input id="validity_period_end" class="datetimepicker" value="@(user_ptw[3] == true && Model.acc_fo_approve == null ? Model.proposed_period_end.Value.ToString("MM/dd/yyyy hh:mm tt") : (Model.validity_period_end != null ? Model.validity_period_end.Value.ToString("MM/dd/yyyy hh:mm tt") : ""))" @(user_ptw[3] == true && Model.acc_fo_approve == null ? "" : "disabled")  >
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="td-centre">
                        <strong><u>Accepted by,</u></strong><br/>
                        <small><em>(I am satisfied that the work site is safe for work to start. I will brief all parties and supervise the work)</em></small>
                    </td>
                </tr>
                <tr>
                    <td class="td-centre">
                        @if (isClearenceComplete.Value && Model.acc_ptw_requestor_approve == null && user_ptw[0] == true)
                        {
                            <button class="btn" type="button" id="requestor_acc">Accept</button><br />
                            <span id="loading_requestor_acc" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_approve_requestor" width="50" height="50" @(Model.acc_ptw_requestor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.acc_ptw_requestor_approve == null ? "" : Model.acc_ptw_requestor_approve.Substring(1))"/><br />
                        }
                        <span>@(listUser.listUser.Where(p => p.id == Model.acc_ptw_requestor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        <strong><u>PTW Requestor</u></strong>
                    </td>
                    <td class="td-centre">
                        @if (Model.acc_ptw_requestor_approve != null && Model.acc_supervisor_approve == null && user_ptw[1] == true)
                        {
                            <button class="btn" type="button" id="supervisor_reject">Reject</button><button class="btn" type="button" id="supervisor_acc">Accept</button><br />
                            <span id="loading_supervisor_acc" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_approve_supervisor" width="50" height="50" @(Model.acc_supervisor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.acc_supervisor_approve == null ? "" : Model.acc_supervisor_approve.Substring(1))"/><br />
                        }
                        @if (Model.acc_supervisor != null)
                        {
                            if ((Model.acc_supervisor_approve == null && Model.acc_supervisor_delegate == requestor.id.ToString()) || (Model.acc_supervisor_approve != null && Model.acc_supervisor_approve.Substring(0, 1) == "d"))
                            {
                                <span>@listUser.listUser.Where(p => p.id == Model.acc_supervisor_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                            }
                            <span>@((Model.acc_supervisor_approve == null && Model.acc_supervisor_delegate == requestor.id.ToString()) || (Model.acc_supervisor_approve != null && Model.acc_supervisor_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.acc_supervisor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        }
                        <strong><u>Supervisor / Project manager</u></strong>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="td-centre">
                        <strong><u>Authorized by,</u></strong><br/>
                        <small><em>(I am satisfied that the work site is safe for work to start. I will brief all parties and supervise the work)</em></small><br />
                        
                    </td>
                </tr>
                <tr>
                    <td class="td-centre">
                        @if (Model.acc_supervisor_approve != null && Model.acc_assessor_approve == null && user_ptw[2] == true)
                        {
                            <button class="btn" type="button" id="assessor_reject">Reject</button><button class="btn" type="button" id="assessor_acc">Accept</button><br />
                            <span id="loading_assessor_acc" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_approve_assessor" width="50" height="50" @(Model.acc_assessor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.acc_assessor_approve == null ? "" : Model.acc_assessor_approve.Substring(1))"/><br />
                        }
                        @if (Model.acc_ptw_requestor_approve != null && Model.acc_supervisor_approve == null && user_ptw[1] == true)
                        {
                            <select id="acc_assessor">
                                <option value="">Choose One</option>
                            @foreach (PermitToWork.Models.User.UserEntity u in listUser.listUser)
                            {
                                 <option value="@u.id" @(Model.acc_assessor == u.id.ToString() ? "selected" : "")>@u.alpha_name</option>   
                            }
                            </select><br />
                        }
                        else if (Model.acc_assessor != null)
                        {
                            if ((Model.acc_assessor_approve == null && Model.acc_assessor_delegate == requestor.id.ToString()) || (Model.acc_assessor_approve != null && Model.acc_assessor_approve.Substring(0, 1) == "d"))
                            {
                                <span>@listUser.listUser.Where(p => p.id == Model.acc_assessor_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                            }
                            <span>@((Model.acc_assessor_approve == null && Model.acc_assessor_delegate == requestor.id.ToString()) || (Model.acc_assessor_approve != null && Model.acc_assessor_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.acc_assessor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        }
                        <strong><u>Assessor</u></strong>
                    </td>
                    <td class="td-centre">
                        @if (Model.acc_assessor_approve != null && Model.acc_fo_approve == null && user_ptw[3] == true)
                        {
                            <button class="btn" type="button" id="fo_reject">Reject</button><button class="btn" type="button" id="fo_acc">Accept</button><br />
                            <span id="loading_fo_acc" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_approve_fo" width="50" height="50" @(Model.acc_fo_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.acc_fo_approve == null ? "" : Model.acc_fo_approve.Substring(1))"/><br />
                        }
                        @if (Model.acc_supervisor_approve != null && Model.acc_assessor_approve == null && user_ptw[2] == true)
                        {
                            <select id="acc_fo">
                                <option value="">Choose One</option>
                            @foreach (PermitToWork.Models.User.UserEntity u in listUser.listUser)
                            {
                                 <option value="@u.id" @(Model.acc_fo == u.id.ToString() ? "selected" : "")>@u.alpha_name</option>   
                            }
                            </select><br />
                        }
                        else if (Model.acc_fo != null)
                        {
                            if ((Model.acc_fo_approve == null && Model.acc_fo_delegate == requestor.id.ToString()) || (Model.acc_fo_approve != null && Model.acc_fo_approve.Substring(0, 1) == "d"))
                            {
                                <span>@listUser.listUser.Where(p => p.id == Model.acc_fo_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                            }
                            <span>@((Model.acc_fo_approve == null && Model.acc_fo_delegate == requestor.id.ToString()) || (Model.acc_fo_approve != null && Model.acc_fo_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.acc_fo.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        }
                        <strong><u>Facility Owner</u></strong>
                    </td>
                </tr>
            </tbody>
        </table>
                        if (isCancel == true)
                        {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="title-form" colspan="4"><strong>4. CANCELATION SCREENING </strong></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="2"><strong>No</strong></td>
                    <td rowspan="2"><strong>Description<br/> </strong><em><small>(Answer the screening items with Yes, No or N/A)</small></em></td>
                    <td colspan="2" class="td-centre"><strong>Assesments (Y, No, N/A)</strong></td>
                </tr>
                <tr>
                    <td><strong>Requestor's Supervisor</strong></td>
                    <td><strong>Facility Owner</strong></td>
                </tr>
                <tr>
                    <td>1</td>
                    <td class="small">Have work completed?</td>
                    <td>
                        <select id="cancel_1_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_1_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_1_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_1_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_1_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_1_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_1_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_1_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td class="small">Have the Clearance Permit(s) canceled?</td>
                    <td>
                        <select id="cancel_2_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_2_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_2_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_2_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_2_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_2_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_2_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_2_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td class="small">Personnel(s) have been notified that this PTW is cancelled</td>
                    <td>
                        <select id="cancel_3_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_3_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_3_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_3_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_3_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_3_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_3_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_3_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td class="small">Worksite and equipment affected left in safe condition</td>
                    <td>
                        <select id="cancel_4_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_4_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_4_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_4_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_4_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_4_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_4_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_4_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>5</td>
                    <td class="small">Is the work performed / construction accepted by work requestor?</td>
                    <td>
                        <select id="cancel_5_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_5_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_5_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_5_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_5_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_5_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_5_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_5_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>6</td>
                    <td class="small">Are the current procedure(s) required to revise</td>
                    <td>
                        <select id="cancel_6_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_6_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_6_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_6_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_6_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_6_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_6_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_6_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>7</td>
                    <td class="small">Have the worksite clear, clean and tidy (housekeeping satisfactory)?</td>
                    <td>
                        <select id="cancel_7_spv" @(user_ptw[4] == true && Model.can_supervisor_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_7_spv == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_7_spv == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_7_spv == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                    <td>
                        <select id="cancel_7_fo" @(user_ptw[6] == true && Model.can_fo_approve == null && Model.has_extend == false ? "" : "disabled")>
                          <option value="0" @(Model.cancel_7_fo == 0 ? "selected" : "")>N/A</option>
                          <option value="1" @(Model.cancel_7_fo == 1 ? "selected" : "")>Yes</option>
                          <option value="2" @(Model.cancel_7_fo == 2 ? "selected" : "")>No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="4" class="small">
                        Note: <em>write any concern related to cancellation PTW, attach other check sheet if necessary
                              </em><br />
                        <textarea class="table-textarea" id="cancel_notes" @(isCancel == true && ((user_ptw[4] == true && Model.can_supervisor_approve == null) || (user_ptw[5] == true && Model.can_assessor_approve == null) || (user_ptw[6] == true && Model.can_fo_approve == null)) && Model.has_extend == false ? "" : "disabled")>@Model.cancel_notes</textarea>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="title-form" colspan="2"><strong>5. CANCELATION</strong></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2">
                        Cancelation date :  <input id="cancellation_date" class="datetimepicker" value="@Model.cancellation_date.Value.ToString("MM/dd/yyyy hh:mm tt")" disabled/>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="td-centre">
                        <strong><u>Permit return by,</u></strong>                        
                    </td>
                </tr>
                <tr>
                    <td class="td-centre" style="width:50%">
                        @if (Model.can_ptw_requestor_approve == null && user_ptw[0] == true && Model.status == (int)PermitToWork.Models.Ptw.PtwEntity.statusPtw.CANCEL && Model.has_extend == false)
                        {
                            <button class="btn" type="button" id="requestor_can">Accept</button><br />
                            <span id="loading_requestor_can" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_cancel_requestor" width="50" height="50" @(Model.can_ptw_requestor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.can_ptw_requestor_approve == null ? "" : Model.can_ptw_requestor_approve.Substring(1))"/><br />
                        }
                        <span>@(listUser.listUser.Where(p => p.id == Model.can_ptw_requestor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        <strong><u>PTW Requestor</u></strong>
                    </td>
                    <td class="td-centre">
                        @if (Model.can_ptw_requestor_approve != null && Model.can_supervisor_approve == null && user_ptw[4] == true && Model.has_extend == false)
                        {
                            <button class="btn" type="button" id="supervisor_reject_can">Reject</button><button class="btn" type="button" id="supervisor_can">Accept</button><br />
                            <span id="loading_supervisor_can" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_cancel_supervisor" width="50" height="50" @(Model.can_supervisor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.can_supervisor_approve == null ? "" : Model.can_supervisor_approve.Substring(1))"/><br />
                        }
                        @if ((Model.can_supervisor_approve == null && Model.can_supervisor_delegate == requestor.id.ToString()) || (Model.can_supervisor_approve != null && Model.can_supervisor_approve.Substring(0, 1) == "d"))
                        {
                            <span>@listUser.listUser.Where(p => p.id == Model.can_supervisor_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                        }
                        <span>@((Model.can_supervisor_approve == null && Model.can_supervisor_delegate == requestor.id.ToString()) || (Model.can_supervisor_approve != null && Model.can_supervisor_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.can_supervisor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        <strong><u>Supervisor / Project manager</u></strong>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="td-centre">
                        <strong><u> Permit cancelled by,</u></strong>
                    </td>
                </tr>
                <tr>
                    <td class="td-centre">
                        @if (Model.can_supervisor_approve != null && Model.can_assessor_approve == null && user_ptw[5] == true && Model.has_extend == false)
                        {
                            <button class="btn" type="button" id="assessor_reject_can">Reject</button><button class="btn" type="button" id="assessor_can">Accept</button><br />
                            <span id="loading_assessor_can" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_cancel_assessor" width="50" height="50" @(Model.can_assessor_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.can_assessor_approve == null ? "" : Model.can_assessor_approve.Substring(1))"/><br />
                        }
                        @if ((Model.can_assessor_approve == null && Model.can_assessor_delegate == requestor.id.ToString()) || (Model.can_assessor_approve != null && Model.can_assessor_approve.Substring(0, 1) == "d"))
                        {
                            <span>@listUser.listUser.Where(p => p.id == Model.can_assessor_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                        }
                        <span>@((Model.can_assessor_approve == null && Model.can_assessor_delegate == requestor.id.ToString()) || (Model.can_assessor_approve != null && Model.can_assessor_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.can_assessor.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        <strong><u>Assessor</u></strong>
                    </td>
                    <td class="td-centre">
                        @if (Model.can_assessor_approve != null && Model.can_fo_approve == null && user_ptw[6] == true && Model.has_extend == false)
                        {
                            <button class="btn" type="button" id="fo_reject_can">Reject</button><button class="btn" type="button" id="fo_can">Accept</button><br />
                            <span id="loading_fo_can" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span><br />
                        }
                        else
                        {
                            <img id="img_cancel_fo" width="50" height="50" @(Model.can_fo_approve == null ? "style=display:none;" : "style=display:inline-block;")  src="@(Model.can_fo_approve == null ? "" : Model.can_fo_approve.Substring(1))"/><br />
                        }
                        @if ((Model.can_fo_approve == null && Model.can_fo_delegate == requestor.id.ToString()) || (Model.can_fo_approve != null && Model.can_fo_approve.Substring(0, 1) == "d"))
                        {
                                <span>@listUser.listUser.Where(p => p.id == Model.can_fo_delegate.AsInt()).FirstOrDefault().alpha_name</span><br />
                        }
                            <span>@((Model.can_fo_approve == null && Model.can_fo_delegate == requestor.id.ToString()) || (Model.can_fo_approve != null && Model.can_fo_approve.Substring(0, 1) == "d") ? "a/n" : "") @(listUser.listUser.Where(p => p.id == Model.can_fo.AsInt()).FirstOrDefault().alpha_name)</span><br />
                        <strong><u>Facility Owner</u></strong>
                    </td>
                </tr>
            </tbody>
        </table>
                        }
}
        <br />

        <button class="btn" onclick="back()">Back</button>  
        @if (isCanEdit == true || Model.status == (int)PermitToWork.Models.Ptw.PtwEntity.statusPtw.CANREQ || Model.status == (int)PermitToWork.Models.Ptw.PtwEntity.statusPtw.CANASS)
        {
        <button class="btn" onclick="save()">Save</button>
        }
        @if (user_ptw[0] == true && Model.status == (int)PermitToWork.Models.Ptw.PtwEntity.statusPtw.ACCFO && isClearenceClose == true)
        {
        <button class="btn" onclick="cancelPtw()">Cancel PTW</button>
        }
        <span id="loading" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span>
    </div>
</div>

<!-- Modal -->
<div id="rejection" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Reject" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Reject</h3>
  </div>
  <div class="modal-body">
    <label for="comment">Comment</label><textarea id="comment"></textarea>
    <input type="hidden" id="type_reject" value="0" />
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary" id="reject_button">Reject</button>
    <span id="loading_reject" style="display:none"><img src="/Content/Images/loading.gif" alt="loading" width="24" height="24" /> Sending Email.. Please Wait..</span>
  </div>
</div>


